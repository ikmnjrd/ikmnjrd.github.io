<!DOCTYPE html><html lang="ja" prefix="og:https://ikmnjrd.github.io/ns#"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0"/><title>Jestの記事 | ikmnjrd.github.io</title><meta name="next-head-count" content="3"/><meta name="author" content="ikmnjrd"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link rel="preload" href="/_next/static/css/86d350262a9fa886.css" as="style"/><link rel="stylesheet" href="/_next/static/css/86d350262a9fa886.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-c354a30bda3d62a6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1bce2145922fb437.js" defer=""></script><script src="/_next/static/chunks/pages/tag/%5Btag%5D-b1402852e922a4c5.js" defer=""></script><script src="/_next/static/t8DPpvWZn1qhWD-Poj93v/_buildManifest.js" defer=""></script><script src="/_next/static/t8DPpvWZn1qhWD-Poj93v/_ssgManifest.js" defer=""></script></head><body class="dark:bg-newmo-800 text-newmo-400 dark:text-newmo-100"><div id="__next"><header class="mb-4 p-4 md:px-8"><div class="flex items-end justify-between"><h1 class="col-start-1 col-end-6"><a class="header-text md:text-5xl text-3xl font-serif decoration-dotted hover:opacity-50 hover:underline active:opacity-30" href="/">ikmnjrd.github.io</a><button class="md:ml-3 ml-2" aria-label="Toggle Theme"><img width="24px" height="24px" class="svg-icon md:w-10 hover:opacity-50 active:opacity-30" src="/light_mode_white_24dp.svg" alt="Dark Mode Status is false" aria-hidden="true"/></button></h1><div class="col-start-6 col-end-7 md:block hidden"><a class="header-text mr-4 md:text-3xl text-2xl font-serif decoration-dotted hover:opacity-50 hover:underline active:opacity-30" href="/about">About</a><a class="header-text md:text-3xl text-2xl font-serif decoration-dotted hover:opacity-50 hover:underline active:opacity-30" href="/tags">Tags</a></div></div><div class="md:hidden text-right "><a class="header-text mr-4 md:text-3xl text-2xl font-serif decoration-dotted hover:opacity-50 hover:underline active:opacity-30" href="/about">About</a><a class="header-text md:text-3xl text-2xl font-serif decoration-dotted hover:opacity-50 hover:underline active:opacity-30" href="/tags">Tags</a></div></header><main class="max-w-2xl md:mx-auto mx-4"><h1 class="text-3xl pt-8 pb-4">Jest<!-- -->の投稿記事一覧</h1><div><li><a class="hover:underline hover:text-newmo-400 visited:text-newmo-300" href="/blog/jest-within-ecma-script">疑問メモ_JestでECMAScriptを使う</a></li></div></main><footer class="text-center text-sm" role="contentinfo"><div class="footer-content"><ul class="flex items-center justify-between max-w-[100px] mx-auto"><li><a href="https://twitter.com/ikmnjrd" target="_blank" rel="nofollow noopener noreferrer" title="Twitter" class="footer-svg hover:opacity-50 block"><svg xmlns="http://www.w3.org/2000/svg" width="2.3em" height="2.3em" viewBox="0 0 64 64" fill="#fff" stroke="currentColor" stroke-width="2.3"><path d="M54.49 12.3c0-.1-.09-.16-.17-.09-1.57 1.36-5.36 2.46-5.84 2.51a.11.11 0 01-.09 0c-2.78-4.44-9.19-3.24-9.19-3.24C29.78 13.48 30.82 23 31 24c0 .05 0 .09-.09.09-10.48.52-19.63-9.22-20.67-10.37a.11.11 0 00-.17 0A10.57 10.57 0 0012.78 27a.11.11 0 010 .19 12.87 12.87 0 01-4-.77c-.06 0-.13 0-.13.1.14 6.2 6.22 9 7.63 9.59a.1.1 0 010 .19 13.4 13.4 0 01-3.85.27.11.11 0 00-.11.14c1.27 4.78 7.5 6.78 8.62 7.11A.11.11 0 0121 44c-3.85 3.44-11.44 4.35-13 4.51a.11.11 0 00-.06.19c5.82 4 21.06 7.32 32.7-2.63A30.3 30.3 0 0051 21.83a.09.09 0 01.05-.08 14.22 14.22 0 005.06-5.06c0-.1 0-.16-.15-.13a5.63 5.63 0 01-3.15.17s1.71-2.96 1.68-4.43z" stroke-linecap="round"></path></svg></a></li><li><a href="https://github.com/ikmnjrd" target="_blank" rel="nofollow noopener noreferrer" title="GitHub" class="footer-svg header-text hover:opacity-50 block"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24" fill="#fff" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></li></ul><p>©︎ikmnjrd -<!-- --> <time dateTime="Sat Aug 27 2022 02:51:19 GMT+0000 (Coordinated Universal Time)">2022</time></p></div><div class="wave"></div><div class="wave"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tag":"Jest","posts":[{"slug":"jest-within-ecma-script","frontmatter":{"title":"疑問メモ_JestでECMAScriptを使う","date":"2022-01-07","tag":["Jest","JavaScript"]},"content":"\n### 疑問\nJestでECMAScriptを使う方法が[公式](https://jestjs.io/ja/docs/ecmascript-modules)に書いてある。\nやってみたけどなぜかできなかったというメモ。\n\n公式通りにやってみた結果以下のエラー。\n\n### エラー全文\n```bash\n% node --experimental-vm-modules node_modules/jest/bin/jest.js\n(node:92238) ExperimentalWarning: VM Modules is an experimental feature. This feature could change at any time\n(Use `node --trace-warnings ...` to show where the warning was created)\n FAIL  ./index.test.js\n  ● Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     • If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.\n     • If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript\n     • To have some of your \"node_modules\" files transformed, you can specify a custom \"transformIgnorePatterns\" in your config.\n     • If you need a custom transformation specify a \"transform\" option in your config.\n     • If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \"moduleNameMapper\" config option.\n\n    You'll find more details and examples of these config options in the docs:\n    https://jestjs.io/docs/configuration\n    For information about custom transformations, see:\n    https://jestjs.io/docs/code-transformation\n\n    Details:\n\n    /Users/ike/workspace/no-degradation-image-converter/index.test.js:1\n    ({\"Object.\u003canonymous\u003e\":function(module,exports,require,__dirname,__filename,jest){import sum from './index';\n                                                                                      ^^^^^^\n\n    SyntaxError: Cannot use import statement outside a module\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1728:14)\n      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)\n\nTest Suites: 1 failed, 1 total\nTests:       0 total\nSnapshots:   0 total\nTime:        0.222 s\n```\n\n### わからないことを辿る\nそもそも実行時に付与してるオプションは、[Node.js]((https://nodejs.org/api/cli.html#--experimental-vm-modules))のサイトでこのように説明されている。\n\u003e--experimental-vm-module\n\u003eEnable experimental ES Module support in the vm module.\n\nとてもあっさり！\n\n`vm module`とはなんぞ？\n要はV8エンジンらしい。以下公式での[Node.jsのサイト](https://nodejs.org/api/vm.html#vm-executing-javascript)での説明\n\u003eThe vm module enables compiling and running code within V8 Virtual Machine contexts. The vm module is not a security mechanism. Do not use it to run untrusted code.\n\nそして迷宮入り。Nodeを16の最新安定版にしてみたけどダメでしたね。\n大人しくCommonJSでrequireします。\n\n\n### 周辺用語\n- Node.js\n- V8\n- VM moduel\n- CommonJS\n- ECMAScript\n\n\n### 参考文献\n- [--experimental-vm-module](https://nodejs.org/api/cli.html#--experimental-vm-modules)\n- [(https://nodejs.org/api/vm.html#vm-executing-javascript)](https://nodejs.org/api/vm.html#vm-executing-javascript)\n- [https://nodejs.org/api/vm.html#vm-executing-javascript](https://nodejs.org/api/vm.html#vm-executing-javascript)\n"}]},"__N_SSG":true},"page":"/tag/[tag]","query":{"tag":"Jest"},"buildId":"t8DPpvWZn1qhWD-Poj93v","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>