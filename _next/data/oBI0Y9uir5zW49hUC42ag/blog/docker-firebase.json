{"pageProps":{"frontmatter":{"title":"DockerとFirebaseで作るReact環境構築","date":"2020-04-01","tag":["Docker","Firebase"]},"slug":"docker-firebase","innerHtml":"<h2 id=\"%E9%83%BD%E5%90%88%E3%81%AE%E3%81%84%E3%81%84docker%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E9%83%BD%E5%90%88%E3%81%AE%E3%81%84%E3%81%84docker%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\" aria-hidden=\"true\">#</a> 都合のいいdockerイメージをダウンロード</h2>\n<p><code>$ docker pull andreysenov/firebase-tools</code></p>\n<p><code>$ mkdir docker-firebase-test</code></p>\n<p>参考: <a href=\"https://hub.docker.com/r/andreysenov/firebase-tools\">https://hub.docker.com/r/andreysenov/firebase-tools</a></p>\n<h2 id=\"docker%E9%96%A2%E9%80%A3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#docker%E9%96%A2%E9%80%A3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90\" aria-hidden=\"true\">#</a> Docker関連ファイルを作成</h2>\n<p><code>$ vi docker-compose.yml</code></p>\n<pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./<span class=\"token punctuation\">:</span>/app \n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8000:3000\"</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"4000:4000\"</span> <span class=\"token comment\">#Emulator Suite UI</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5000:5000\"</span> <span class=\"token comment\">#Firebase Hosting</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5001:5001\"</span> <span class=\"token comment\">#Cloud Functions</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8080:8080\"</span> <span class=\"token comment\">#Cloud Firestore</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8085:8085\"</span> <span class=\"token comment\">#Cloud Pub/Sub</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9000:9000\"</span> <span class=\"token comment\">#Realtime Database</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9005:9005\"</span> <span class=\"token comment\">#Firebase Login</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9099:9099\"</span> <span class=\"token comment\">#Authentication</span>\n    \n    <span class=\"token key atrule\">tty</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">stdin_open</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n</code></pre>\n<p><code>$ vi Dcokerfile</code></p>\n<pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> andreysenov/firebase-tools</span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span>\n</code></pre>\n<h2 id=\"%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E7%94%A8%E6%84%8F\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E7%94%A8%E6%84%8F\" aria-hidden=\"true\">#</a> ホスティングするファイルを用意</h2>\n<p>今回はReactをcreate-react-appで用意\nコンテナに入ってreactをインストール</p>\n<p><code>$ docker-compose build</code></p>\n<p><code>$ docker-compose up -d</code></p>\n<p><code>$ docker exec -it docker-firebase-test_web_1 sh</code></p>\n<p><code>$ cd /app</code></p>\n<p><code>$ npx create-react-app sample-app --template typescript</code></p>\n<p><code>$ exit</code></p>\n<h2 id=\"docker-compose.yml%E3%82%92%E7%B7%A8%E9%9B%86\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#docker-compose.yml%E3%82%92%E7%B7%A8%E9%9B%86\" aria-hidden=\"true\">#</a> docker-compose.ymlを編集</h2>\n<p><code>$ vi docker-compose.yml</code></p>\n<pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./<span class=\"token punctuation\">:</span>/app \n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> sh <span class=\"token punctuation\">-</span>c \"cd /app/sample<span class=\"token punctuation\">-</span>app <span class=\"token important\">&amp;&amp;</span> yarn start\"\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8000:3000\"</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"4000:4000\"</span> <span class=\"token comment\">#Emulator Suite UI</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5000:5000\"</span> <span class=\"token comment\">#Firebase Hosting</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5001:5001\"</span> <span class=\"token comment\">#Cloud Functions</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8080:8080\"</span> <span class=\"token comment\">#Cloud Firestore</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8085:8085\"</span> <span class=\"token comment\">#Cloud Pub/Sub</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9000:9000\"</span> <span class=\"token comment\">#Realtime Database</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9005:9005\"</span> <span class=\"token comment\">#Firebase Login</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9099:9099\"</span> <span class=\"token comment\">#Authentication</span>\n    \n    <span class=\"token key atrule\">tty</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">stdin_open</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n</code></pre>\n<h2 id=\"firebase%E3%81%B8%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#firebase%E3%81%B8%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\" aria-hidden=\"true\">#</a> firebaseへデプロイ</h2>\n<p><code>$ docker-compose up -d</code></p>\n<p><code>$ docker exec -it docker-firebase-test_web_1 sh</code></p>\n<p><code>$ cd /app/react-ts-app</code></p>\n<p><code>$ firebase login --no-localhost</code></p>\n<p><code>$ firebase init hosting</code></p>\n<p>firebase.jsonを編集してfirebaseが公開ディレクトリをpublicディレクトリではなく、buildディレクトリを参照するように変更</p>\n<p><code>$ vi firebase.json</code></p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"hosting\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"public\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ignore\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"firebase.json\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"**/.*\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"**/node_modules/**\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"rewrites\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"**\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"destination\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/index.html\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<p><code>$ firebase deploy</code></p>\n","createdAt":"2022-10-18","updatedAt":"2022-10-18"},"__N_SSG":true}