{"pageProps":{"tag":"Linux","posts":[{"slug":"linux-hardware-2024-03","frontmatter":{"title":"自作PCの構成_2024-03","date":"2024-04-09","tag":["Linux","misc"]},"content":"\n\n### ハードウェア\n| 部品　        | 名称                                         |\n|:--------------|:---------------------------------------------|\n| CPU    　     | AMD Ryzen 7 7745HX (オンボード)              |\n| マザーボード  | Minisforum BD770i                            |\n| GPU           | ASUS Radeon RX 7600 OC  8GB                  |\n| メモリ        | Crucial 32GB DDR5 4800MHz SODIMM             |\n| HDD           | Crucial T500 1TB PCIe Gen4 NVMe M.2 SSD      |\n| CPUファン     | Noctua NF-A12x25 PWM chromax.Black.swap      |\n| 電源          | Cooler Master V850 SFX Gold ATX3.0           |\n| ケース        | Cooler Master MasterBox NR200P ホワイト      |\n\n\n### ソフトウェア\n| 部品　        | 名称                                         |\n|:--------------|:---------------------------------------------|\n| OS     　     | EndeavourOS Linux x86_64                     |\n| WindowManager | i3                                           |\n\n\n### ざっくり構成を伝えるコピペ用\n|               |                                   |\n|:--------------|:----------------------------------|\n| OS     　     | EndeavourOS Linux x86_64          |\n| WM            | i3                                |\n| CPU    　     | AMD Ryzen 7 7745HX (オンボード)   |\n| マザーボード  | Minisforum BD770i                 |\n| GPU           | ASUS Radeon RX 7600 OC  8GB       |"},{"slug":"novnc-kali-linux","frontmatter":{"title":"kali linuxでVNCサーバーにnovncで接続する","date":"2021-10-31","tag":["Linux"]},"content":"[公式](https://www.kali.org/docs/general-use/novnc-kali-in-browser/)にやり方も書いてあるがこの通りだとエラーが出た。\n\n`$ sudo apt install -y x11vnc`\n\n以下の部分をそのまま実行するとエラーが出る。\n$ x11vnc -display :0 -autoport -localhost -nopw -bg -xkb -ncache -ncache_cr-quiet -forever\n```bash\n31/10/2021 20:23:07 passing arg to libvncserver: -ncache_cr-quiet\n31/10/2021 20:23:07 x11vnc version: 0.9.16 lastmod: 2019-01-05  pid: 2173\n31/10/2021 20:23:07 Using X display :0\n31/10/2021 20:23:07 rootwin: 0x764 reswin: 0x3800001 dpy: 0x1dc24970\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 ------------------ USEFUL INFORMATION ------------------\n31/10/2021 20:23:07 X DAMAGE available on display, using it for polling hints.\n31/10/2021 20:23:07   To disable this behavior use: '-noxdamage'\n31/10/2021 20:23:07 \n31/10/2021 20:23:07   Most compositing window managers like 'compiz' or 'beryl'\n31/10/2021 20:23:07   cause X DAMAGE to fail, and so you may not see any screen\n31/10/2021 20:23:07   updates via VNC.  Either disable 'compiz' (recommended) or\n31/10/2021 20:23:07   supply the x11vnc '-noxdamage' command line option.\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 Wireframing: -wireframe mode is in effect for window moves.\n31/10/2021 20:23:07   If this yields undesired behavior (poor response, painting\n31/10/2021 20:23:07   errors, etc) it may be disabled:\n31/10/2021 20:23:07    - use '-nowf' to disable wireframing completely.\n31/10/2021 20:23:07    - use '-nowcr' to disable the Copy Rectangle after the\n31/10/2021 20:23:07      moved window is released in the new position.\n31/10/2021 20:23:07   Also see the -help entry for tuning parameters.\n31/10/2021 20:23:07   You can press 3 Alt_L's (Left \"Alt\" key) in a row to \n31/10/2021 20:23:07   repaint the screen, also see the -fixscreen option for\n31/10/2021 20:23:07   periodic repaints.\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 XFIXES available on display, resetting cursor mode\n31/10/2021 20:23:07   to: '-cursor most'.\n31/10/2021 20:23:07   to disable this behavior use: '-cursor arrow'\n31/10/2021 20:23:07   or '-noxfixes'.\n31/10/2021 20:23:07 using XFIXES for cursor drawing.\n31/10/2021 20:23:07 GrabServer control via XTEST.\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 Scroll Detection: -scrollcopyrect mode is in effect to\n31/10/2021 20:23:07   use RECORD extension to try to detect scrolling windows\n31/10/2021 20:23:07   (induced by either user keystroke or mouse input).\n31/10/2021 20:23:07   If this yields undesired behavior (poor response, painting\n31/10/2021 20:23:07   errors, etc) it may be disabled via: '-noscr'\n31/10/2021 20:23:07   Also see the -help entry for tuning parameters.\n31/10/2021 20:23:07   You can press 3 Alt_L's (Left \"Alt\" key) in a row to \n31/10/2021 20:23:07   repaint the screen, also see the -fixscreen option for\n31/10/2021 20:23:07   periodic repaints.\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 Client Side Caching: -ncache mode is in effect to provide\n31/10/2021 20:23:07   client-side pixel data caching.  This speeds up\n31/10/2021 20:23:07   iconifying/deiconifying windows, moving and raising\n31/10/2021 20:23:07   windows, and reposting menus.  In the simple CopyRect\n31/10/2021 20:23:07   encoding scheme used (no compression) a huge amount\n31/10/2021 20:23:07   of extra memory (20-100MB) is used on both the server and\n31/10/2021 20:23:07   client sides.  This mode works with any VNC viewer.\n31/10/2021 20:23:07   However, in most you can actually see the cached pixel\n31/10/2021 20:23:07   data by scrolling down, so you need to re-adjust its size.\n31/10/2021 20:23:07   See http://www.karlrunge.com/x11vnc/faq.html#faq-client-caching.\n31/10/2021 20:23:07   If this mode yields undesired behavior (poor response,\n31/10/2021 20:23:07   painting errors, etc) it may be disabled via: '-ncache 0'\n31/10/2021 20:23:07   You can press 3 Alt_L's (Left \"Alt\" key) in a row to \n31/10/2021 20:23:07   repaint the screen, also see the -fixscreen option for\n31/10/2021 20:23:07   periodic repaints.\n31/10/2021 20:23:07 X FBPM extension not supported.\n31/10/2021 20:23:07 X display is capable of DPMS.\n31/10/2021 20:23:07 --------------------------------------------------------\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 Default visual ID: 0x21\n31/10/2021 20:23:07 Read initial data from X display into framebuffer.\n31/10/2021 20:23:07 initialize_screen: fb_depth/fb_bpp/fb_Bpl 24/32/7680\n31/10/2021 20:23:07 *** unrecognized option(s) ***\n31/10/2021 20:23:07     [1]  -ncache_cr-quiet\n31/10/2021 20:23:07 For a list of options run: x11vnc -opts\n31/10/2021 20:23:07 or for the full help: x11vnc -help\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 Here is a list of removed or obsolete options:\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 removed: -hints, -nohints\n31/10/2021 20:23:07 removed: -cursorposall\n31/10/2021 20:23:07 removed: -nofilexfer, now the default.\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 renamed: -old_copytile, use -onetile\n31/10/2021 20:23:07 renamed: -mouse,   use -cursor\n31/10/2021 20:23:07 renamed: -mouseX,  use -cursor X\n31/10/2021 20:23:07 renamed: -X,       use -cursor X\n31/10/2021 20:23:07 renamed: -nomouse, use -nocursor\n31/10/2021 20:23:07 renamed: -old_pointer, use -pointer_mode 1\n```\n\nそのため以下のように実行\n$ x11vnc -display :0 -autoport -localhost -nopw -bg -xkb -ncache -forever\n\n\n起動確認\n\n`$ ss -antp | grep vnc`\n\n```bash\nLISTEN    0         32                127.0.0.1:5900            0.0.0.0:*        users:((\"x11vnc\",pid=8056,fd=8))\nLISTEN    0         32                    [::1]:5900               [::]:*        users:((\"x11vnc\",pid=8056,fd=9))\nkali@kali:~$\n```\n\n\n\n\nここでもエラーが出る。\n$ /usr/share/novnc/utils/launch.sh --listen 8081 --vnc localhost\n```bash\nWarning: could not find self.pem\nUsing installed websockify at /usr/bin/websockify\nStarting webserver and WebSockets proxy on port 8081\nUsage: \n    websockify [options] [source_addr:]source_port [target_addr:target_port]\n    websockify [options] [source_addr:]source_port -- WRAP_COMMAND_LINE\n\nwebsockify: error: Error parsing target\nFailed to start WebSockets proxy\n```\n[novnc公式のIssue](https://github.com/novnc/noVNC/issues/1443)でも似た症状が報告されてた。\n\n\n`$ cd ~`\n`$ git clone https://github.com/novnc/noVNC.git`\n`$ cd noVnc/utils/novnc_proxy --vnc localhost:5900`\n\n\n\nサーバー側の別のターミナルでsshを有効にする（？）\n`$ sudo systemctl enable ssh --now`\n\n\nクライアントのターミナルからポートフォワーディング。sshでログインした状態になればOK。\n`ssh kali@192.168.0.140 -L 6080:localhost:6080`\n\n\nクライアントのWebブラウザで以下のようにアクセスする。\nhttp://localhost:6080/vnc.html\n"},{"slug":"steam-lib32-vulkan-driver","frontmatter":{"title":"Steam(Linux)でWindows用ゲームが起動後即クラッシュした","date":"2024-04-09","tag":["Linux","EndeavourOS","Steam"]},"content":"\n### 状況\n[xz-utilsの件](https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27)で環境のチェックやアップデートなどを終えたタイミングでsteam(proton)で動かしてるwindows向けのゲームが起動後、画面も立ち上がらないままクラッシュしてしまうようになった。ちなみにタイトルはエルデンリングです。\n\n\n### 環境\n|               |                                   |\n|:--------------|:----------------------------------|\n| OS     　     | EndeavourOS Linux x86_64          |\n| WM            | i3                                |\n| CPU    　     | AMD Ryzen 7 7745HX (オンボード)   |\n| GPU           | ASUS Radeon RX 7600 OC  8GB       |\n\n\n\n### トラブルシューティング\nSteamのログの取り方は各ゲームの「管理」>「プロパティ」>「一般」>「起動オプション」のテキストフォームに\n```\nPROTON_LOG=1 %command%\n```\nと入力する。そしてゲームを起動するとホームディレクトリにsteam-{game-id}.logファイルができる。\n\n```\n~~~~~~\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: eax=000000e2 ebx=00000001 ecx=00000000 edx=00000000 esi=00000001 edi=0621f5a8\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: ebp=0621f6b8 esp=0621f578 eip=7bf4c8ec cs=0023 ss=002b flags=00000246\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: ds=002b es=002b fs=0063 gs=006b\n3600.766:012c:0148:trace:seh:handle_syscall_fault code=c0000005 flags=0 addr=0xeaf11209 ip=eaf11209\n3600.766:012c:0148:trace:seh:handle_syscall_fault  info[0]=00000000\n3600.766:012c:0148:trace:seh:handle_syscall_fault  info[1]=000000b0\n3600.766:012c:0148:trace:seh:handle_syscall_fault  eax=0000000a ebx=ed220538 ecx=03fbf595 edx=000000ac esi=00000000 edi=0000000a\n3600.766:012c:0148:trace:seh:handle_syscall_fault  ebp=eb89dec8 esp=028f7c90 cs=0023 ds=002b es=002b fs=0063 gs=006b flags=00010206\n3600.766:012c:0148:warn:seh:handle_syscall_fault backtrace: --- Exception 0xc0000005 at 0xeaf11209: /usr/lib/pressure-vessel/overrides/lib/i386-linux-gnu/vulkan/amdvlk32.so + 0x290d209.\n3600.766:012c:0148:trace:seh:handle_syscall_fault returning to user mode ip=7a1dba0a ret=c0000005\n3600.766:012c:0148:err:msvcrt:_wassert (L\"!status && \\\"vkCreateGraphicsPipelines\\\"\",L\"../src-wine/dlls/winevulkan/loader_thunks.c\",2934)\n3600.766:012c:0148:trace:seh:raise (22)\n3600.790:0030:0198:warn:threadname:NtSetInformationThread Thread renamed to L\"wine_threadpool_worker\"\n3600.790:0030:019c:warn:threadname:NtSetInformationThread Thread renamed to L\"wine_threadpool_worker\"\n3600.790:0030:01a0:warn:threadname:NtSetInformationThread Thread renamed to L\"wine_threadpool_worker\"\npid 122815 != 122814, skipping destruction (fork without exec?)\n```\n\nprotonのバージョンを古すぎるものにしなければ、いくら設定を変えて試してもこのようなログになった。\n\n\n### 対処方法\nログを自分なりに解釈すると、wineというwindowsアプリ互換を提供するアプリケーションのamdグラフィックス用のプログラムの部分が動いてなさそう。  \nなので、wine等を依存としてインストールしていたsteamを一旦依存とともにアンインストール\n```sh\n$ sudo pacman -Rs steam\n```\n\nそしてもう一度インストール\n```sh\n$ sudo pacman -S steam\n```\n![pacmanインストール](https://i.gyazo.com/d21c04fe1d4c66589b30bd9803dff017.png)\n\n前回まではデフォルトとされていたamdvlkとlib32-amdvlkをインストールしていたが、他のやつで自分の環境にあっていそうなvulkan-radeonとlib32-vulkan-radeonを選択してインストール。\n\nこれで無事起動できました。\n\n\n### 参考文献\n- [xz-utils backdoor situation (CVE-2024-3094)](https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27)\n- [Where does Steam Linux save its game crash logs? : r/linux_gaming](https://www.reddit.com/r/linux_gaming/comments/15c6t32/where_does_steam_linux_save_its_game_crash_logs/)\n- [Steam/トラブルシューティング - ArchWiki](https://wiki.archlinux.jp/index.php/Steam/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)"}]},"__N_SSG":true}