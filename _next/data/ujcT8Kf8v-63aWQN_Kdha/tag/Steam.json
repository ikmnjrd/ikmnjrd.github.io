{"pageProps":{"tag":"Steam","posts":[{"slug":"steam-lib32-vulkan-driver","frontmatter":{"title":"Steam(Linux)でWindows用ゲームが起動後即クラッシュした","date":"2024-04-09","tag":["Linux","EndeavourOS","Steam"]},"content":"\n### 状況\n[xz-utilsの件](https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27)で環境のチェックやアップデートなどを終えたタイミングでsteam(proton)で動かしてるwindows向けのゲームが起動後、画面も立ち上がらないままクラッシュしてしまうようになった。ちなみにタイトルはエルデンリングです。\n\n\n### 環境\n|               |                                   |\n|:--------------|:----------------------------------|\n| OS     　     | EndeavourOS Linux x86_64          |\n| WM            | i3                                |\n| CPU    　     | AMD Ryzen 7 7745HX (オンボード)   |\n| GPU           | ASUS Radeon RX 7600 OC  8GB       |\n\n\n\n### トラブルシューティング\nSteamのログの取り方は各ゲームの「管理」>「プロパティ」>「一般」>「起動オプション」のテキストフォームに\n```\nPROTON_LOG=1 %command%\n```\nと入力する。そしてゲームを起動するとホームディレクトリにsteam-{game-id}.logファイルができる。\n\n```\n~~~~~~\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: eax=000000e2 ebx=00000001 ecx=00000000 edx=00000000 esi=00000001 edi=0621f5a8\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: ebp=0621f6b8 esp=0621f578 eip=7bf4c8ec cs=0023 ss=002b flags=00000246\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: ds=002b es=002b fs=0063 gs=006b\n3600.766:012c:0148:trace:seh:handle_syscall_fault code=c0000005 flags=0 addr=0xeaf11209 ip=eaf11209\n3600.766:012c:0148:trace:seh:handle_syscall_fault  info[0]=00000000\n3600.766:012c:0148:trace:seh:handle_syscall_fault  info[1]=000000b0\n3600.766:012c:0148:trace:seh:handle_syscall_fault  eax=0000000a ebx=ed220538 ecx=03fbf595 edx=000000ac esi=00000000 edi=0000000a\n3600.766:012c:0148:trace:seh:handle_syscall_fault  ebp=eb89dec8 esp=028f7c90 cs=0023 ds=002b es=002b fs=0063 gs=006b flags=00010206\n3600.766:012c:0148:warn:seh:handle_syscall_fault backtrace: --- Exception 0xc0000005 at 0xeaf11209: /usr/lib/pressure-vessel/overrides/lib/i386-linux-gnu/vulkan/amdvlk32.so + 0x290d209.\n3600.766:012c:0148:trace:seh:handle_syscall_fault returning to user mode ip=7a1dba0a ret=c0000005\n3600.766:012c:0148:err:msvcrt:_wassert (L\"!status && \\\"vkCreateGraphicsPipelines\\\"\",L\"../src-wine/dlls/winevulkan/loader_thunks.c\",2934)\n3600.766:012c:0148:trace:seh:raise (22)\n3600.790:0030:0198:warn:threadname:NtSetInformationThread Thread renamed to L\"wine_threadpool_worker\"\n3600.790:0030:019c:warn:threadname:NtSetInformationThread Thread renamed to L\"wine_threadpool_worker\"\n3600.790:0030:01a0:warn:threadname:NtSetInformationThread Thread renamed to L\"wine_threadpool_worker\"\npid 122815 != 122814, skipping destruction (fork without exec?)\n```\n\nprotonのバージョンを古すぎるものにしなければ、いくら設定を変えて試してもこのようなログになった。\n\n\n### 対処方法\nログを自分なりに解釈すると、wineというwindowsアプリ互換を提供するアプリケーションのamdグラフィックス用のプログラムの部分が動いてなさそう。  \nなので、wine等を依存としてインストールしていたsteamを一旦依存とともにアンインストール\n```sh\n$ sudo pacman -Rs steam\n```\n\nそしてもう一度インストール\n```sh\n$ sudo pacman -S steam\n```\n![pacmanインストール](https://i.gyazo.com/d21c04fe1d4c66589b30bd9803dff017.png)\n\n前回まではデフォルトとされていたamdvlkとlib32-amdvlkをインストールしていたが、他のやつで自分の環境にあっていそうなvulkan-radeonとlib32-vulkan-radeonを選択してインストール。\n\nこれで無事起動できました。\n\n\n### 参考文献\n- [xz-utils backdoor situation (CVE-2024-3094)](https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27)\n- [Where does Steam Linux save its game crash logs? : r/linux_gaming](https://www.reddit.com/r/linux_gaming/comments/15c6t32/where_does_steam_linux_save_its_game_crash_logs/)\n- [Steam/トラブルシューティング - ArchWiki](https://wiki.archlinux.jp/index.php/Steam/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)"}]},"__N_SSG":true}