{"pageProps":{"frontmatter":{"title":"Next.jsがWebpackを使うから嫌いという話","date":"2022-02-09","tag":["webpack","Next.js","JavaScript"]},"slug":"Next-webpack","innerHtml":"<p>今まであまりrequireとimportなどの違いを意識できていない人間。\nNext.jsをプロジェクトに導入するのは賛成をとるが、個人のプロジェクトにはあまり使いたくないなーと思う程度の距離感を保っていた人間だった。現在無職。</p>\n<p>しかし、新たな職場を探すにあたってReactは使うのにNext.jsを触ったことがないというのは自分の選択肢を狭めるだけだと考え、無職期間に作り直そうとしていたRuby(Jekyll)製ブログを、Next.jsのSSGの仕組みを用いて作ることにした。（本当はメジャーバージョンがリリースされたばかりのeleventy.jsを使って作りたかった。フレームワークに求めているもの的にもeleventyの方が合っていたと今も感じる。1週間ほどはeleventy.js製のブログだった時期もある。）</p>\n<p>同リポジトリ内にマークダウンでブログ記事を上げるため、ビルド時に色々なものを生成したい要件が出てくる。Next.jsは内部でwebpackを使っていて<code>next.config.js</code>ではその一端を見ることができる。</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">reactStrictMode</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">webpack</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> isServer <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isServer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./scripts/generate-sitemap.js'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>webpackはCommonJSで書かれていることは事前知識として知っていた。</p>\n<p>とは言ってもimportやexportが使いたい。<code>package.json</code>に<code>&quot;type&quot;: &quot;module&quot;</code>を追加する方法などを試してみるが、最終的にproduction buildの際のfsモジュールが解決できないとか<code>Import trace for requested module: ./pages/_app.js</code>などのエラーメッセージを残して終了していくプログラムを見るとイライラしてくる。</p>\n<p>勉強のためとはいえ、今度からNode.jsではなくDenoを使おうかなという気持ちになった。</p>\n<h3 id=\"%E5%91%A8%E8%BE%BA%E7%94%A8%E8%AA%9E\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%91%A8%E8%BE%BA%E7%94%A8%E8%AA%9E\" aria-hidden=\"true\">#</a> 周辺用語</h3>\n<ul>\n<li>commonJS</li>\n<li>ESModules</li>\n<li>ES6(ES2015)</li>\n</ul>\n<h3 id=\"%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" aria-hidden=\"true\">#</a> 参考文献</h3>\n<ul>\n<li><a href=\"https://blog.logrocket.com/build-sitemap-generator-nextjs/\">Build a sitemap generator in Next.js - LogRocket Blog</a></li>\n<li><a href=\"https://github.com/vercel/next.js/issues/9607\">Support ES module format (ESM) in next.config.js #9607</a></li>\n<li><a href=\"https://github.com/vercel/next.js/discussions/32239\">Support ES module format (ESM) in next.config.js #32239</a></li>\n</ul>\n","anchors":[{"text":"周辺用語","link":"%E5%91%A8%E8%BE%BA%E7%94%A8%E8%AA%9E"},{"text":"参考文献","link":"%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"}]},"__N_SSG":true}