{"pageProps":{"frontmatter":{"title":"kali linuxでVNCサーバーにnovncで接続する","date":"2021-10-31","tag":["Linux"]},"slug":"novnc-kali-linux","innerHtml":"<p><a href=\"https://www.kali.org/docs/general-use/novnc-kali-in-browser/\">公式</a>にやり方も書いてあるがこの通りだとエラーが出た。</p>\n<p><code>$ sudo apt install -y x11vnc</code></p>\n<p>以下の部分をそのまま実行するとエラーが出る。\n$ x11vnc -display :0 -autoport -localhost -nopw -bg -xkb -ncache -ncache_cr-quiet -forever</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 passing arg to libvncserver: -ncache_cr-quiet\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 x11vnc version: <span class=\"token number\">0.9</span>.16 lastmod: <span class=\"token number\">2019</span>-01-05  pid: <span class=\"token number\">2173</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 Using X display :0\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 rootwin: 0x764 reswin: 0x3800001 dpy: 0x1dc24970\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 ------------------ USEFUL INFORMATION ------------------\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 X DAMAGE available on display, using it <span class=\"token keyword\">for</span> polling hints.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   To disable this behavior use: <span class=\"token string\">'-noxdamage'</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   Most compositing window managers like <span class=\"token string\">'compiz'</span> or <span class=\"token string\">'beryl'</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   cause X DAMAGE to fail, and so you may not see any <span class=\"token function\">screen</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   updates via VNC.  Either disable <span class=\"token string\">'compiz'</span> <span class=\"token punctuation\">(</span>recommended<span class=\"token punctuation\">)</span> or\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   supply the x11vnc <span class=\"token string\">'-noxdamage'</span> <span class=\"token builtin class-name\">command</span> line option.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 Wireframing: <span class=\"token parameter variable\">-wireframe</span> mode is <span class=\"token keyword\">in</span> effect <span class=\"token keyword\">for</span> window moves.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   If this yields undesired behavior <span class=\"token punctuation\">(</span>poor response, painting\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   errors, etc<span class=\"token punctuation\">)</span> it may be disabled:\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07    - use <span class=\"token string\">'-nowf'</span> to disable wireframing completely.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07    - use <span class=\"token string\">'-nowcr'</span> to disable the Copy Rectangle after the\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07      moved window is released <span class=\"token keyword\">in</span> the new position.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   Also see the <span class=\"token parameter variable\">-help</span> entry <span class=\"token keyword\">for</span> tuning parameters.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   You can press <span class=\"token number\">3</span> Alt_L<span class=\"token string\">'s (Left \"Alt\" key) in a row to \n31/10/2021 20:23:07   repaint the screen, also see the -fixscreen option for\n31/10/2021 20:23:07   periodic repaints.\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 XFIXES available on display, resetting cursor mode\n31/10/2021 20:23:07   to: '</span><span class=\"token parameter variable\">-cursor</span> <span class=\"token function\">most</span><span class=\"token string\">'.\n31/10/2021 20:23:07   to disable this behavior use: '</span>-cursor arrow<span class=\"token string\">'\n31/10/2021 20:23:07   or '</span>-noxfixes<span class=\"token string\">'.\n31/10/2021 20:23:07 using XFIXES for cursor drawing.\n31/10/2021 20:23:07 GrabServer control via XTEST.\n31/10/2021 20:23:07 \n31/10/2021 20:23:07 Scroll Detection: -scrollcopyrect mode is in effect to\n31/10/2021 20:23:07   use RECORD extension to try to detect scrolling windows\n31/10/2021 20:23:07   (induced by either user keystroke or mouse input).\n31/10/2021 20:23:07   If this yields undesired behavior (poor response, painting\n31/10/2021 20:23:07   errors, etc) it may be disabled via: '</span>-noscr<span class=\"token string\">'\n31/10/2021 20:23:07   Also see the -help entry for tuning parameters.\n31/10/2021 20:23:07   You can press 3 Alt_L'</span>s <span class=\"token punctuation\">(</span>Left <span class=\"token string\">\"Alt\"</span> key<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> a row to \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   repaint the screen, also see the <span class=\"token parameter variable\">-fixscreen</span> option <span class=\"token keyword\">for</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   periodic repaints.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 Client Side Caching: <span class=\"token parameter variable\">-ncache</span> mode is <span class=\"token keyword\">in</span> effect to provide\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   client-side pixel data caching.  This speeds up\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   iconifying/deiconifying windows, moving and raising\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   windows, and reposting menus.  In the simple CopyRect\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   encoding scheme used <span class=\"token punctuation\">(</span>no compression<span class=\"token punctuation\">)</span> a huge amount\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   of extra memory <span class=\"token punctuation\">(</span><span class=\"token number\">20</span>-100MB<span class=\"token punctuation\">)</span> is used on both the server and\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   client sides.  This mode works with any VNC viewer.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   However, <span class=\"token keyword\">in</span> <span class=\"token function\">most</span> you can actually see the cached pixel\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   data by scrolling down, so you need to re-adjust its size.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   See http://www.karlrunge.com/x11vnc/faq.html<span class=\"token comment\">#faq-client-caching.</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   If this mode yields undesired behavior <span class=\"token punctuation\">(</span>poor response,\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   painting errors, etc<span class=\"token punctuation\">)</span> it may be disabled via: <span class=\"token string\">'-ncache 0'</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   You can press <span class=\"token number\">3</span> Alt_L's <span class=\"token punctuation\">(</span>Left <span class=\"token string\">\"Alt\"</span> key<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> a row to \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   repaint the screen, also see the <span class=\"token parameter variable\">-fixscreen</span> option <span class=\"token keyword\">for</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07   periodic repaints.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 X FBPM extension not supported.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 X display is capable of DPMS.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 --------------------------------------------------------\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 Default visual ID: 0x21\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 Read initial data from X display into framebuffer.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 initialize_screen: fb_depth/fb_bpp/fb_Bpl <span class=\"token number\">24</span>/32/7680\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 *** unrecognized option<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> ***\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07     <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>  -ncache_cr-quiet\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 For a list of options run: x11vnc <span class=\"token parameter variable\">-opts</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 or <span class=\"token keyword\">for</span> the full help: x11vnc <span class=\"token parameter variable\">-help</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 Here is a list of removed or obsolete options:\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 removed: -hints, <span class=\"token parameter variable\">-nohints</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 removed: <span class=\"token parameter variable\">-cursorposall</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 removed: -nofilexfer, now the default.\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 \n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 renamed: -old_copytile, use <span class=\"token parameter variable\">-onetile</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 renamed: -mouse,   use <span class=\"token parameter variable\">-cursor</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 renamed: -mouseX,  use <span class=\"token parameter variable\">-cursor</span> X\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 renamed: -X,       use <span class=\"token parameter variable\">-cursor</span> X\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 renamed: -nomouse, use <span class=\"token parameter variable\">-nocursor</span>\n<span class=\"token number\">31</span>/10/2021 <span class=\"token number\">20</span>:23:07 renamed: -old_pointer, use <span class=\"token parameter variable\">-pointer_mode</span> <span class=\"token number\">1</span>\n</code></pre>\n<p>そのため以下のように実行\n$ x11vnc -display :0 -autoport -localhost -nopw -bg -xkb -ncache -forever</p>\n<p>起動確認</p>\n<p><code>$ ss -antp | grep vnc</code></p>\n<pre class=\"language-bash\"><code class=\"language-bash\">LISTEN    <span class=\"token number\">0</span>         <span class=\"token number\">32</span>                <span class=\"token number\">127.0</span>.0.1:5900            <span class=\"token number\">0.0</span>.0.0:*        users:<span class=\"token variable\"><span class=\"token punctuation\">((</span>\"x11vnc\"<span class=\"token punctuation\">,</span>pid<span class=\"token operator\">=</span><span class=\"token number\">8056</span><span class=\"token punctuation\">,</span>fd<span class=\"token operator\">=</span><span class=\"token number\">8</span><span class=\"token punctuation\">))</span></span>\nLISTEN    <span class=\"token number\">0</span>         <span class=\"token number\">32</span>                    <span class=\"token punctuation\">[</span>::1<span class=\"token punctuation\">]</span>:5900               <span class=\"token punctuation\">[</span>::<span class=\"token punctuation\">]</span>:*        users:<span class=\"token variable\"><span class=\"token punctuation\">((</span>\"x11vnc\"<span class=\"token punctuation\">,</span>pid<span class=\"token operator\">=</span><span class=\"token number\">8056</span><span class=\"token punctuation\">,</span>fd<span class=\"token operator\">=</span><span class=\"token number\">9</span><span class=\"token punctuation\">))</span></span>\nkali@kali:~$\n</code></pre>\n<p>ここでもエラーが出る。\n$ /usr/share/novnc/utils/launch.sh --listen 8081 --vnc localhost</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">Warning: could not <span class=\"token function\">find</span> self.pem\nUsing installed websockify at /usr/bin/websockify\nStarting webserver and WebSockets proxy on port <span class=\"token number\">8081</span>\nUsage: \n    websockify <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>source_addr:<span class=\"token punctuation\">]</span>source_port <span class=\"token punctuation\">[</span>target_addr:target_port<span class=\"token punctuation\">]</span>\n    websockify <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>source_addr:<span class=\"token punctuation\">]</span>source_port -- WRAP_COMMAND_LINE\n\nwebsockify: error: Error parsing target\nFailed to start WebSockets proxy\n</code></pre>\n<p><a href=\"https://github.com/novnc/noVNC/issues/1443\">novnc公式のIssue</a>でも似た症状が報告されてた。</p>\n<p><code>$ cd ~</code>\n<code>$ git clone https://github.com/novnc/noVNC.git</code>\n<code>$ cd noVnc/utils/novnc_proxy --vnc localhost:5900</code></p>\n<p>サーバー側の別のターミナルでsshを有効にする（？）\n<code>$ sudo systemctl enable ssh --now</code></p>\n<p>クライアントのターミナルからポートフォワーディング。sshでログインした状態になればOK。\n<code>ssh kali@192.168.0.140 -L 6080:localhost:6080</code></p>\n<p>クライアントのWebブラウザで以下のようにアクセスする。\nhttp://localhost:6080/vnc.html</p>\n","createdAt":"2022-10-15","updatedAt":"2022-10-15"},"__N_SSG":true}