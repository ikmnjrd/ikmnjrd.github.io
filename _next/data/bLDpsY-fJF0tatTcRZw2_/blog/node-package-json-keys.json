{"pageProps":{"frontmatter":{"title":"ESモジュール内でJSONを読み込む方法","description":"ESモジュール内でJSONを読み込む方法","date":"2022-08-06","tag":["Node.js","JavaScript","JSON"]},"slug":"node-package-json-keys","innerHtml":"<h3 id=\"%E6%A5%BD%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8Bnode%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E6%A5%BD%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8Bnode%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3\" aria-hidden=\"true\">#</a> 楽ができるNodeのバージョン</h3>\n<p>Node.js<code>v17.5~</code>もしくは<code>v16</code>の<code>--experimental-json-modules</code>オブションを使えば利用できます。</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* index.js */</span>\n<span class=\"token comment\">// An import assertion in a static import</span>\n<span class=\"token keyword\">import</span> info <span class=\"token keyword\">from</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./package.json</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token keyword\">assert</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">json</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// An import assertion in a dynamic import</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> info <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./package.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">assert</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p><code>v16</code>でオプション付きで実行する場合は<code>$ node --experimental-json-modules index.js</code>と実行します。\nちなみに<code>--experimental-wasm-modules</code>というオプションで<code>wasm</code>も読み込めます。</p>\n<h3 id=\"%E5%AF%BE%E8%B1%A1%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E4%BB%A5%E5%A4%96%E3%81%A7%E3%82%84%E3%82%8B%E6%96%B9%E6%B3%95\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%AF%BE%E8%B1%A1%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E4%BB%A5%E5%A4%96%E3%81%A7%E3%82%84%E3%82%8B%E6%96%B9%E6%B3%95\" aria-hidden=\"true\">#</a> 対象のバージョン以外でやる方法</h3>\n<ol>\n<li>JSONを読み込み自力でパースする</li>\n</ol>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> readFile <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs/promises'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./some-file.json'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<ol start=\"2\">\n<li><a href=\"https://nodejs.org/api/module.html#module_module_createrequire_filename\">createRequire</a>を使う</li>\n</ol>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRequire <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> require <span class=\"token operator\">=</span> <span class=\"token function\">createRequire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span><span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./data.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"%E5%8F%82%E8%80%83\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%8F%82%E8%80%83\" aria-hidden=\"true\">#</a> 参考</h3>\n<p>本記事のソースコードおよび内容は以下のリンク先から引用しています。</p>\n<ul>\n<li><a href=\"https://www.stefanjudis.com/snippets/how-to-import-json-files-in-es-modules-node-js/\">How to import JSON files in ES modules (Node.js)</a></li>\n</ul>\n","anchors":[{"text":"楽ができるnodeのバージョン","link":"%E6%A5%BD%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8Bnode%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3"},{"text":"対象のバージョン以外でやる方法","link":"%E5%AF%BE%E8%B1%A1%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E4%BB%A5%E5%A4%96%E3%81%A7%E3%82%84%E3%82%8B%E6%96%B9%E6%B3%95"},{"text":"参考","link":"%E5%8F%82%E8%80%83"}]},"__N_SSG":true}