{"pageProps":{"frontmatter":{"title":"リファクタリングしてますか？","description":"社のチーム内での共有に書いたメモの一部","date":"2024-04-27","tag":["ポエム","リファクタリング"]},"slug":"refactoring-and-develop","innerHtml":"<h3 id=\"%E4%BC%9D%E3%81%88%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8%E3%81%AE%E7%B5%90%E8%AB%96\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E4%BC%9D%E3%81%88%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8%E3%81%AE%E7%B5%90%E8%AB%96\" aria-hidden=\"true\">#</a> 伝えたいことの結論</h3>\n<p>「リファクタリング」という言葉には新機能の追加タスクでも既存コードベースの改修が含まれる。</p>\n<h4 id=\"%E8%87%AA%E5%B7%B1%E7%B4%B9%E4%BB%8B\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E8%87%AA%E5%B7%B1%E7%B4%B9%E4%BB%8B\" aria-hidden=\"true\">#</a> 自己紹介</h4>\n<p>前提として、私自身は小さな受託システム開発会社（50人規模）で働くWebエンジニアで主に新規開発を転々とやっています。</p>\n<h3 id=\"%E3%81%84%E3%81%A4%E3%82%84%E3%82%8B%E3%81%8B\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E3%81%84%E3%81%A4%E3%82%84%E3%82%8B%E3%81%8B\" aria-hidden=\"true\">#</a> いつやるか</h3>\n<p>コードを触る機会があったなら、それは常にリファクタリングするタイミング。</p>\n<h3 id=\"%E4%BE%8B%E3%81%88%E8%A9%B1\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E4%BE%8B%E3%81%88%E8%A9%B1\" aria-hidden=\"true\">#</a> 例え話</h3>\n<p>料金を表示するコードがあったとする。</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> price <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n      price<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ja-JP\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token string\">\"currency\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JPY\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>もし料金を国別の表にするという変更があったら、次のようにしたとする。</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> priceJP <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n<span class=\"token keyword\">const</span> priceUS <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">日本: </span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n       priceJP<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ja-JP\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token string\">\"currency\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JPY\"</span><span class=\"token punctuation\">,</span>\n       <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">米国: </span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n       priceUS<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"en-US\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token string\">\"currency\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">\"USD\"</span><span class=\"token punctuation\">,</span>\n       <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>priceだったものが暗黙の了解として日本料金を示していたが、他の国が入ったことで暗黙の了解は崩れそれぞれを明示するに至った。<br>\n私はこれをいい変更だと考えるものとして次の話に進む。</p>\n<h3 id=\"%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%82%84%E3%81%A4\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%82%84%E3%81%A4\" aria-hidden=\"true\">#</a> 実際によくあるやつ</h3>\n<p>この部分を既存コードの変更を嫌がって次のようにすることってまま稀によくあると思う。</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> price <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">// 名前の変更もしない</span>\n<span class=\"token keyword\">const</span> priceUS <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token comment\">// 新しく追加</span>\n</code></pre>\n<p>私はこういう時、変更の箇所が増えて自分が負わないでいい責任を負ってる感覚を味わうことがあるが、そこも含めてリファクタリングや仕様変更と呼びたい。</p>\n<p>しかもこういった部分は <code>price</code> のままにするとレビュワーからは差分にならないのでGitHub上から見えづらい。</p>\n<p>そのためレビュイーに頼る部分が多くなるが、善意でバグを発生させようとも善意を持ちたい（静的解析ツールを存分に頼ろう）</p>\n"},"__N_SSG":true}