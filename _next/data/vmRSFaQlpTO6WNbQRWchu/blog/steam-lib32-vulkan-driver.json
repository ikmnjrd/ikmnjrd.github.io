{"pageProps":{"frontmatter":{"title":"Steam(Linux)でWindows用ゲームが起動後即クラッシュした","date":"2024-04-09","tag":["Linux","EndeavourOS","Steam"]},"slug":"steam-lib32-vulkan-driver","innerHtml":"<h3 id=\"%E7%8A%B6%E6%B3%81\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E7%8A%B6%E6%B3%81\" aria-hidden=\"true\">#</a> 状況</h3>\n<p><a href=\"https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27\">xz-utilsの件</a>で環境のチェックやアップデートなどを終えたタイミングでsteam(proton)で動かしてるwindows向けのゲームが起動後、画面も立ち上がらないままクラッシュしてしまうようになった。ちなみにタイトルはエルデンリングです。</p>\n<h3 id=\"%E7%92%B0%E5%A2%83\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E7%92%B0%E5%A2%83\" aria-hidden=\"true\">#</a> 環境</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">OS</td>\n<td style=\"text-align:left\">EndeavourOS Linux x86_64</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">WM</td>\n<td style=\"text-align:left\">i3</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">CPU</td>\n<td style=\"text-align:left\">AMD Ryzen 7 7745HX (オンボード)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">GPU</td>\n<td style=\"text-align:left\">ASUS Radeon RX 7600 OC  8GB</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\" aria-hidden=\"true\">#</a> トラブルシューティング</h3>\n<p>Steamのログの取り方は各ゲームの「管理」&gt;「プロパティ」&gt;「一般」&gt;「起動オプション」のテキストフォームに</p>\n<pre><code>PROTON_LOG=1 %command%\n</code></pre>\n<p>と入力する。そしてゲームを起動するとホームディレクトリにsteam-{game-id}.logファイルができる。</p>\n<pre><code>~~~~~~\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: eax=000000e2 ebx=00000001 ecx=00000000 edx=00000000 esi=00000001 edi=0621f5a8\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: ebp=0621f6b8 esp=0621f578 eip=7bf4c8ec cs=0023 ss=002b flags=00000246\n3600.766:012c:0190:trace:seh:NtGetContextThread 0xfffffffe: ds=002b es=002b fs=0063 gs=006b\n3600.766:012c:0148:trace:seh:handle_syscall_fault code=c0000005 flags=0 addr=0xeaf11209 ip=eaf11209\n3600.766:012c:0148:trace:seh:handle_syscall_fault  info[0]=00000000\n3600.766:012c:0148:trace:seh:handle_syscall_fault  info[1]=000000b0\n3600.766:012c:0148:trace:seh:handle_syscall_fault  eax=0000000a ebx=ed220538 ecx=03fbf595 edx=000000ac esi=00000000 edi=0000000a\n3600.766:012c:0148:trace:seh:handle_syscall_fault  ebp=eb89dec8 esp=028f7c90 cs=0023 ds=002b es=002b fs=0063 gs=006b flags=00010206\n3600.766:012c:0148:warn:seh:handle_syscall_fault backtrace: --- Exception 0xc0000005 at 0xeaf11209: /usr/lib/pressure-vessel/overrides/lib/i386-linux-gnu/vulkan/amdvlk32.so + 0x290d209.\n3600.766:012c:0148:trace:seh:handle_syscall_fault returning to user mode ip=7a1dba0a ret=c0000005\n3600.766:012c:0148:err:msvcrt:_wassert (L&quot;!status &amp;&amp; \\&quot;vkCreateGraphicsPipelines\\&quot;&quot;,L&quot;../src-wine/dlls/winevulkan/loader_thunks.c&quot;,2934)\n3600.766:012c:0148:trace:seh:raise (22)\n3600.790:0030:0198:warn:threadname:NtSetInformationThread Thread renamed to L&quot;wine_threadpool_worker&quot;\n3600.790:0030:019c:warn:threadname:NtSetInformationThread Thread renamed to L&quot;wine_threadpool_worker&quot;\n3600.790:0030:01a0:warn:threadname:NtSetInformationThread Thread renamed to L&quot;wine_threadpool_worker&quot;\npid 122815 != 122814, skipping destruction (fork without exec?)\n</code></pre>\n<p>protonのバージョンを古すぎるものにしなければ、いくら設定を変えて試してもこのようなログになった。</p>\n<h3 id=\"%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95\" aria-hidden=\"true\">#</a> 対処方法</h3>\n<p>ログを自分なりに解釈すると、wineというwindowsアプリ互換を提供するアプリケーションのamdグラフィックス用のプログラムの部分が動いてなさそう。<br>\nなので、wine等を依存としてインストールしていたsteamを一旦依存とともにアンインストール</p>\n<pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">sudo</span> pacman <span class=\"token parameter variable\">-Rs</span> steam\n</code></pre>\n<p>そしてもう一度インストール</p>\n<pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">sudo</span> pacman <span class=\"token parameter variable\">-S</span> steam\n</code></pre>\n<p><img src=\"/images/posts/steam-lib32-vulkan-driver-0.avif\" alt=\"pacmanインストール\"></p>\n<p>前回まではデフォルトとされていたamdvlkとlib32-amdvlkをインストールしていたが、他のやつで自分の環境にあっていそうなvulkan-radeonとlib32-vulkan-radeonを選択してインストール。</p>\n<p>これで無事起動できました。</p>\n<h3 id=\"%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" aria-hidden=\"true\">#</a> 参考文献</h3>\n<ul>\n<li><a href=\"https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27\">xz-utils backdoor situation (CVE-2024-3094)</a></li>\n<li><a href=\"https://www.reddit.com/r/linux_gaming/comments/15c6t32/where_does_steam_linux_save_its_game_crash_logs/\">Where does Steam Linux save its game crash logs? : r/linux_gaming</a></li>\n<li><a href=\"https://wiki.archlinux.jp/index.php/Steam/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\">Steam/トラブルシューティング - ArchWiki</a></li>\n</ul>\n"},"__N_SSG":true}