{"pageProps":{"frontmatter":{"title":"ネーミングを忘れて大量にできたdocker volumeをまとめて削除する方法","description":"docker volumeをshellscriptでまとめて削除する方法","date":"2022-07-24","tag":["shellscript","bash"]},"slug":"bash-sed-docker-volume","innerHtml":"<h3 id=\"%E7%B5%90%E8%AB%96\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E7%B5%90%E8%AB%96\" aria-hidden=\"true\">#</a> 結論</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> volume <span class=\"token function\">ls</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s/local[[:space:]]*//g'</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">'.{64,64}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">docker</span> volume <span class=\"token function\">rm</span>\n</code></pre>\n<p>Driverの部分(localとスペース)を削除。\n64文字の（ハッシュで自動生成された）ものをリストアップ。\n削除（使用中のボリュームは削除されない）。</p>\n<h3 id=\"%E8%AA%AC%E6%98%8E\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E8%AA%AC%E6%98%8E\" aria-hidden=\"true\">#</a> 説明</h3>\n<p>気づいたら溜まってしまったdocker volumeたち。。\nふと確認してみたらえらいことになってしまっていた。\n`$ docker volume ls</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">DRIVER    VOLUME NAME\nlocal     1d516cb7225f448d8bb634875487b5eaa35d329696f77f3ae2347a3abb6aa94a\nlocal     1fbaf3b6210ce64906fffdc1ecf9d711f2d25ebe99dfc2ca3ad3f3aca1a33801\nlocal     3b4da7efd093305d43c40a004c22669f0b8ae8ac5f933c582a4168c9dff51763\nlocal     4aada75a0a85dc48abf02fdff03aab5c3fafeaf096567b6517fc6faf62511749\nlocal     5aa299e15cfeb3a5e3b41c1ab53a17382a11c64101918d916ee9d1e95b0e4672\nlocal     5cd2395082c05f3acb1f910cf77fb5a1ba1c0e845f8522912a5a82a37e0946ce\nlocal     5d76f9a14aa7462eedd428b33c6473125ecc9e442e88fcaabf06e946e20b19d9\nlocal     5f4ba17454db26acce81f3b4ce02d31e270e3c585238db4019b3a2a8482e2238\nlocal     6b4605498282f9b00b367551dfb3d121e7dcaa89626a3785d5dd2914d6138712\n</code></pre>\n<p>これらをまとめて消したい。（ハッシュ値ではなく名前をきちっとつけてたものは消したくない。）</p>\n<p><code>$ sed -e 's/local[[:space:]]*//g'</code>で加工して、\n<code>$ grep -E '.{64,64}'</code>で加工して、\ndocker volume rmコマンドの引数に渡す</p>\n<h3 id=\"%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\" aria-hidden=\"true\">#</a> ハマったポイント</h3>\n<p><code>$ sed -e &quot;s/'local[[:space:]]+'//g</code> とやってみたが\n<code>+</code>を1文字以上のマッチでズバッといけると思ったが<code>local</code>の部分もまとめて残ってしまった。</p>\n<p><code>sed -e 's/local[[:space:]]*//g</code>これだとうまくいった。0文字以上だからなんか不具合起きそうとしたが...shecllscriptの正規表現はこれだから...</p>\n<p>スペースやタブを<code>\\s</code>や<code>\\t</code>で検出しようとしてたが、色々みてたら<code>[[:space&quot;]]</code>の方が確実っぽいような書き方してるのがちらちらと見えた気がする</p>\n<h3 id=\"%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" aria-hidden=\"true\">#</a> 参考文献</h3>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/15509536/regex-space-character-in-sed\">Regex Space character in Sed - Stack Overflow</a></li>\n<li><a href=\"https://qiita.com/ko1nksm/items/53abc144558b9bb5629f\">正しく理解できる！シェルスクリプトとPOSIXの正規表現（令和最新版）〜 基本正規表現BREと拡張正規表現EREについて - Qiita</a></li>\n</ul>\n","anchors":[{"text":"結論","link":"%E7%B5%90%E8%AB%96"},{"text":"説明","link":"%E8%AA%AC%E6%98%8E"},{"text":"ハマったポイント","link":"%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88"},{"text":"参考文献","link":"%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"}]},"__N_SSG":true}